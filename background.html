<html>
<head>
<script>
  // A dictionary keyed off of tabId that keeps track of data per tab (for
  // example what feedUrl was detected in the tab).
  var canonical_urls = {};

  chrome.extension.onRequest.addListener(function(request, sender) {
    if (request.msg == "canonicalExists") {
      canonical_urls[sender.tab.id] = request.canonical;
      chrome.pageAction.setTitle(
        {
          tabId: sender.tab.id,
          title: "Canonical url: " + request.canonical
        }
      );
      chrome.pageAction.show(sender.tab.id);
    }
  });

  chrome.tabs.onRemoved.addListener(function(tabId) {
    delete canonical_urls[tabId];
  });

  chrome.pageAction.onClicked.addListener( function(tab) {
    console.log('clicked!', 'we should go to', canonical_urls[tab.id]);
  });

</script>
</head>
</html>
